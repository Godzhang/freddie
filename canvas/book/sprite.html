<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../reset.css" />
  <script src="../public/utils.js"></script>
  <script src="../public/sprite.js"></script>
  <style>
    #canvas {}
  </style>
  <title>model</title>
</head>

<body>
  <canvas id="canvas"></canvas>

  <script>
    //
    const canvasWidth = document.body.clientWidth;
    const canvasHeight = document.body.clientHeight;
    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");
    canvas.width = canvasWidth;
    canvas.height = canvasHeight;
  </script>
  <script>
    //
    const CLOCK_RADIUS = canvasWidth / 2 - 15;
    const HOUR_HAND_TRUNCATION = 35;

    const ballPainter = {
      paint(sprite, context) {
        const { top, left, width, height } = sprite;
        const x = left + width / 2
        const y = top + height / 2
        const radius = width / 2

        context.save()
        context.beginPath()
        context.arc(x, y, radius, 0, Math.PI * 2)
        context.clip()

        context.shadowColor = "rgb(0,0,0)";
        context.shadowOffsetX = -4;
        context.shadowOffsetY = -4;
        context.shadowBlur = 8;

        context.fillStyle = "rgba(30, 144, 255, 0.15)";
        context.fill();

        context.lineWidth = 2;
        context.strokeStyle = "rgb(100, 100, 195)";
        context.stroke();

        context.restore()
      },
    };
    const ball = new Sprite('ball', ballPainter)

    function drawHand(loc, isHour) {
      const angle = Math.PI * 2 * loc / 60 - Math.PI / 2
      const handRadius = isHour ? CLOCK_RADIUS - HOUR_HAND_TRUNCATION : CLOCK_RADIUS
      const lineEnd = {
        x: canvasWidth / 2 + Math.cos(angle) * (handRadius - ball.width / 2),
        y: canvasHeight / 2 + Math.sin(angle) * (handRadius - ball.width / 2)
      }

      context.beginPath()
      context.moveTo(canvasWidth / 2, canvasHeight / 2)
      context.lineTo(lineEnd.x, lineEnd.y)
      context.stroke()

      ball.left = canvasWidth / 2 + Math.cos(angle) * handRadius - ball.width / 2
      ball.top = canvasHeight / 2 + Math.sin(angle) * handRadius - ball.height / 2
      ball.paint(context)
    }
    function drawHands() {
      const date = new Date()
      let hour = date.getHours()

      ball.width = 20
      ball.height = 20
      drawHand(date.getSeconds(), false)

      hour = hour > 12 ? hour - 12 : hour
      ball.width = 35
      ball.height = 35
      drawHand(date.getMinutes(), false)

      ball.width = 50
      ball.height = 50
      drawHand(hour * 5 + (date.getMinutes() / 60) * 5, true)

      ball.width = 10
      ball.height = 10
      ball.left = canvasWidth / 2 - ball.width / 2
      ball.top = canvasHeight / 2 - ball.height / 2
      ballPainter.paint(ball, context)
    }
    function drawClock() {
      drawClockFace()
      drawHands()
    }
    function drawClockFace() {
      context.beginPath()
      context.arc(canvasWidth / 2, canvasHeight / 2, CLOCK_RADIUS, 0, Math.PI * 2)
      context.save()
      context.strokeStyle = 'rgba(0, 0, 0, 0.2)'
      context.stroke()
      context.restore()
    }
    function animate() {
      context.clearRect(0, 0, canvasWidth, canvasHeight)
      drawGrid(context, "lightgray", 10, 10);
      drawClock()

      requestAnimationFrame(animate)
    }

    context.lineWidth = 0.5;
    context.strokeStyle = "rgba(0, 0, 0, 0.2)";
    // context.shadowColor = "rgba(0, 0, 0, 0.5)";
    // context.shadowOffsetX = 2;
    // context.shadowOffsetY = 2;
    // context.shadowBlur = 4;
    // context.stroke();

    drawGrid(context, "lightgray", 10, 10);

    animate();
  </script>
  <script>
      //
      // const RADIUS = 75;
      // const painter = {
      //   paint(sprite, context) {
      //     const { top, left, width, height } = sprite;
      //     context.beginPath();
      //     context.arc(
      //       left + width / 2,
      //       top + height / 2,
      //       RADIUS,
      //       0,
      //       Math.PI * 2
      //     );
      //     context.clip();

      //     context.shadowColor = "rgb(0,0,0)";
      //     context.shadowOffsetX = -4;
      //     context.shadowOffsetY = -4;
      //     context.shadowBlur = 8;

      //     context.lineWidth = 2;
      //     context.strokeStyle = "rgb(100, 100, 195)";
      //     context.fillStyle = "rgba(30, 144, 255, 0.15)";
      //     context.fill();
      //     context.stroke();
      //   },
      // };
      // const ball = new Sprite("ball", painter);
      // drawGrid(context, "lightgray", 10, 10);
      // ball.left = 320;
      // ball.top = 160;
      // ball.paint(context);
  </script>
</body>

</html>